<style>
  .safe-bottom { padding-bottom: calc(env(safe-area-inset-bottom) + 16px); }

  /* ✅ Medida única (mismos márgenes que venimos usando) */
  .app-shell { padding-left: 6px; padding-right: 6px; padding-top: 0px; padding-bottom: 0px; }
  @media (min-width: 640px) { .app-shell { padding-left: 12px; padding-right: 12px; padding-top: 0px; } }
  @media (min-width: 768px) { .app-shell { padding-left: 16px; padding-right: 16px; padding-top: 0px; } }
</style>

<div class="flex items-start justify-center min-h-[calc(100vh-200px)] app-shell py-6 sm:py-8">
  <div
    class="w-full max-w-full sm:max-w-5xl lg:max-w-7xl xl:max-w-screen-xl mx-auto
           bg-gradient-to-br from-slate-900/95 via-slate-900/90 to-slate-950/95
           backdrop-blur-md rounded-2xl shadow-2xl border border-slate-700/80
           p-4 sm:p-6 md:p-10 text-white safe-bottom overflow-x-hidden"
  >

    <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold text-center mb-6 sm:mb-10 tracking-tight">
      Panel de <%= cobrador.nombre %> <%= cobrador.apellido %>
    </h1>

    <!-- Resumen + Código -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 mb-8 sm:mb-10">

      <!-- Total recaudado -->
      <div class="bg-slate-900/70 border border-emerald-500/60 rounded-xl p-4 shadow-md">
        <p class="text-xs uppercase tracking-wide text-emerald-200/90">Total Recaudado</p>
        <p class="text-2xl sm:text-3xl font-extrabold text-emerald-300 mt-1 break-words">
          <%= totalCobradoFormateado %>
        </p>
      </div>

      <!-- Código de retiro o botón -->
      <% if (codigoGenerado) { %>
        <div class="bg-slate-900/70 border border-amber-400/60 rounded-xl p-4 shadow-md">
          <p class="text-xs uppercase tracking-wide text-amber-200/90">Código de retiro generado</p>
          <p class="text-xl font-mono tracking-wide font-bold mt-1 <%= codigoExpirado ? 'text-red-400' : 'text-amber-300' %>">
            <%= codigoGenerado %> <%= codigoExpirado ? '(vencido)' : '' %>
          </p>
        </div>
      <% } else { %>
        <div class="bg-slate-900/70 border border-amber-400/60 rounded-xl p-4 shadow-md flex flex-col justify-between">
          <p class="text-xs uppercase tracking-wide text-amber-200/90 mb-2">Generar código de retiro</p>
          <form action="/retiros/generar-codigo" method="POST">
            <input type="hidden" name="cobradorId" value="<%= cobrador._id %>" />
            <button class="bg-amber-500 hover:bg-amber-600 text-black font-semibold px-4 py-2 rounded-lg shadow transition w-full">
              Generar código
            </button>
          </form>
        </div>
      <% } %>
    </div>

    <!-- Accesos rápidos -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 mb-8 sm:mb-10">
      <a href="#"
        class="block bg-slate-900/60 border border-slate-700/80 rounded-xl p-4 sm:p-6 shadow hover:bg-slate-900/80 transition min-h-[110px]">
        <h2 class="text-lg sm:text-xl font-semibold text-rose-300 mb-1 sm:mb-2">
          Historial de Retiros
        </h2>
        <p class="text-sm text-slate-300">
          Visualizar todos los retiros realizados hasta la fecha.
        </p>
      </a>

      <a href="#"
        class="block bg-slate-900/60 border border-slate-700/80 rounded-xl p-4 sm:p-6 shadow hover:bg-slate-900/80 transition min-h-[110px]">
        <h2 class="text-lg sm:text-xl font-semibold text-emerald-300 mb-1 sm:mb-2">
          Historial de Movimientos
        </h2>
        <p class="text-sm text-slate-300">
          Visualizar todos los movimientos realizados hasta la fecha.
        </p>
      </a>
    </div>

    <!-- Historial financiero -->
    <div class="mt-8 sm:mt-10">
      <h2 class="text-base sm:text-lg font-semibold text-white mb-4">
        Historial financiero
      </h2>

      <div class="max-w-full bg-slate-900/70 shadow rounded-xl border border-slate-700/80 overflow-hidden">
        <div class="w-full max-w-full overflow-x-auto">
          <table class="min-w-[820px] w-full text-sm text-white">
            <thead class="bg-slate-800 text-sky-200 uppercase text-xs tracking-wide">
              <tr>
                <th class="px-3 py-3 text-left">Fecha</th>
                <th class="px-3 py-3 text-left">N° Comp.</th>
                <th class="px-3 py-3 text-left">Tipo</th>
                <th class="px-3 py-3 text-left">Detalle</th>
                <th class="px-3 py-3 text-right">Importe</th>
                <th class="px-3 py-3 text-right">Saldo</th>
              </tr>
            </thead>

            <tbody>
              <% if (historial.length === 0) { %>
                <tr>
                  <td colspan="6" class="text-center py-4 text-slate-400">Sin movimientos aún.</td>
                </tr>
              <% } else {
                historial.slice().reverse().forEach((mov) => {
                  const importe = mov.cargo ? mov.cargo : mov.pago ? -mov.pago : 0;
              %>
                <tr class="border-t border-slate-700 hover:bg-slate-800/80 transition-colors">
                  <td class="px-3 py-2 whitespace-nowrap"><%= mov.fecha %></td>
                  <td class="px-3 py-2 whitespace-nowrap"><%= mov.numero %></td>
                  <td class="px-3 py-2 whitespace-nowrap"><%= mov.tipo %></td>
                  <td class="px-3 py-2 break-words">
                    <%= mov.detalle || (mov.cliente ? `Cobro a ${mov.cliente.nombre} ${mov.cliente.apellido}` : "Cobro") %>
                  </td>
                  <td class="px-3 py-2 text-right whitespace-nowrap <%= importe < 0 ? 'text-rose-400' : 'text-emerald-400' %>">
                    <%= importe.toLocaleString("es-AR", { style: "currency", currency: "ARS" }) %>
                  </td>
                  <td class="px-3 py-2 text-right whitespace-nowrap font-semibold">
                    <%= mov.saldo.toLocaleString("es-AR", { style: "currency", currency: "ARS" }) %>
                  </td>
                </tr>
              <% }) } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>
