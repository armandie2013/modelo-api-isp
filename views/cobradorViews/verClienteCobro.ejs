<style>
  .safe-bottom { padding-bottom: calc(env(safe-area-inset-bottom) + 16px); }

  /* Medida única para toda la app */
  .app-shell { padding-left: 6px; padding-right: 6px; padding-top: 0px; padding-bottom: 0px; }
  @media (min-width: 640px) { .app-shell { padding-left: 12px; padding-right: 12px; } }
  @media (min-width: 768px) { .app-shell { padding-left: 16px; padding-right: 16px; } }
</style>

<div class="flex items-start justify-center min-h-[calc(100vh-200px)] app-shell py-6 sm:py-8">
  <div
    class="w-full max-w-full sm:max-w-5xl lg:max-w-7xl xl:max-w-screen-xl mx-auto
           bg-gradient-to-br from-slate-900/95 via-slate-900/90 to-slate-950/95
           backdrop-blur-md rounded-2xl shadow-2xl border border-slate-700/80
           p-4 sm:p-6 md:p-10 text-white safe-bottom overflow-x-hidden"
  >

    <!-- ================= HEADER ================= -->
    <header class="mb-8">
      <p class="text-xs uppercase tracking-widest text-slate-400 mb-2">
        Cobros · Cliente
      </p>

      <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold tracking-tight">
        <%= cliente.nombre %> <%= cliente.apellido %>
      </h1>

      <!-- Datos compactos -->
      <div class="mt-2 text-sm text-slate-300 space-y-1">
        <p>
          <span class="text-slate-400">DNI:</span>
          <%= cliente.dni %>
        </p>

        <p>
          <span class="text-slate-400">Teléfono:</span>
          <%= cliente.telefono || "—" %>
        </p>

        <p>
          <span class="text-slate-400">Plan:</span>
          <%= cliente.plan?.nombre || "—" %>
          <% if (cliente.plan?.precioFormateado) { %>
            – <span class="text-emerald-300 font-medium"><%= cliente.plan.precioFormateado %></span>
          <% } %>
        </p>
      </div>
    </header>

    <!-- ================= SALDO ================= -->
    <div class="rounded-xl p-4 shadow-md mb-8
                <%= saldoActual > 0 
                    ? 'bg-slate-900/70 border border-rose-500/60' 
                    : 'bg-slate-900/70 border border-emerald-500/60' %>">

      <p class="text-xs uppercase tracking-wide
                <%= saldoActual > 0 ? 'text-rose-200/90' : 'text-emerald-200/90' %>">
        Saldo actual del cliente
      </p>

      <p class="text-2xl sm:text-3xl font-extrabold mt-1 break-words
                <%= saldoActual > 0 ? 'text-rose-400' : 'text-emerald-300' %>">
        <%= saldoFormateado %>
      </p>

      <!-- <p class="text-xs mt-2
                <%= saldoActual < 0 ? 'text-rose-200/80' : 'text-emerald-200/80' %>">
        <%= saldoActual < 0 
            ? 'En rojo: el cliente debe.' 
            : 'En verde: saldo a favor del cliente.' %>
      </p> -->
    </div>

    <!-- ================= HISTORIAL ================= -->
    <div class="mb-10">
      <h2 class="text-lg font-semibold mb-4">Historial financiero</h2>

      <div class="bg-slate-900/70 rounded-xl border border-slate-700/80 overflow-hidden">
        <div class="overflow-x-auto">
          <table class="min-w-[820px] w-full text-sm">
            <thead class="bg-slate-800 text-sky-200 uppercase text-xs">
              <tr>
                <th class="px-3 py-3 text-left">Fecha</th>
                <th class="px-3 py-3 text-left">Comp.</th>
                <th class="px-3 py-3 text-left">Tipo</th>
                <th class="px-3 py-3 text-left">Detalle</th>
                <th class="px-3 py-3 text-right">Importe</th>
                <th class="px-3 py-3 text-right">Saldo</th>
              </tr>
            </thead>
            <tbody>
              <% if (historial.length === 0) { %>
                <tr>
                  <td colspan="6" class="py-4 text-center text-slate-400">
                    Sin movimientos aún.
                  </td>
                </tr>
              <% } else { historial.forEach(mov => { %>
                <tr class="border-t border-slate-700 hover:bg-slate-800/80">
                  <td class="px-3 py-2 whitespace-nowrap">
                    <%= new Date(mov.fecha).toLocaleDateString("es-AR") %>
                  </td>
                  <td class="px-3 py-2"><%= mov.numero || "-" %></td>
                  <td class="px-3 py-2 capitalize"><%= mov.tipo %></td>
                  <td class="px-3 py-2 truncate max-w-[280px]">
                    <%= mov.detalle || "-" %>
                  </td>
                  <td class="px-3 py-2 text-right <%= mov.importe < 0 ? 'text-rose-400' : 'text-emerald-400' %>">
                    <%= mov.importeFormateado %>
                  </td>
                  <td class="px-3 py-2 text-right font-semibold">
                    <%= mov.saldoFormateado %>
                  </td>
                </tr>
              <% }) } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ================= FACTURAS IMPAGAS ================= -->
    <h2 class="text-lg font-semibold mb-4">Facturas impagas</h2>

    <% if (facturasImpagas.length === 0) { %>
      <p class="text-slate-400">No hay facturas pendientes.</p>
    <% } else { %>
      <form action="/cobros/registrar" method="POST"
            onsubmit="return confirm('¿Confirmás registrar el cobro?')">
        <input type="hidden" name="clienteId" value="<%= cliente._id %>">

        <div class="bg-slate-900/70 rounded-xl border border-slate-700/80 overflow-hidden">
          <div class="overflow-x-auto">
            <table class="min-w-[600px] w-full text-sm">
              <thead class="bg-slate-800 text-sky-200 uppercase text-xs">
                <tr>
                  <th class="px-4 py-3 text-center">✔</th>
                  <th class="px-4 py-3">Fecha</th>
                  <th class="px-4 py-3">Detalle</th>
                  <th class="px-4 py-3 text-right">Importe</th>
                </tr>
              </thead>
              <tbody>
                <% facturasImpagas.forEach(f => { %>
                  <tr class="border-t border-slate-700 hover:bg-slate-800/80">
                    <td class="px-4 py-2 text-center">
                      <input type="checkbox" name="facturasSeleccionadas" value="<%= f._id %>">
                    </td>
                    <td class="px-4 py-2">
                      <%= new Date(f.fecha).toLocaleDateString("es-AR") %>
                    </td>
                    <td class="px-4 py-2"><%= f.detalle %></td>
                    <td class="px-4 py-2 text-right">
                      <%= f.importeFormateado %>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        </div>

        <div class="text-center mt-6">
          <button
            type="submit"
            class="bg-emerald-600 hover:bg-emerald-700 px-6 py-2 rounded-lg font-semibold shadow">
            Registrar cobro
          </button>
        </div>
      </form>
    <% } %>

  </div>
</div>

