<main>
  <style>
    .safe-bottom { padding-bottom: calc(env(safe-area-inset-bottom) + 16px); }
  </style>

  <!-- ✅ IGUAL que Admin dashboard (misma altura y mismo espacio arriba) -->
  <div class="flex items-start justify-center min-h-[calc(100vh-200px)] px-2 sm:px-4 py-0 sm:py-5">
    <div
      class="w-full max-w-full sm:max-w-5xl lg:max-w-7xl xl:max-w-screen-xl mx-auto
             bg-gradient-to-br from-slate-900/95 via-slate-900/90 to-slate-950/95
             backdrop-blur-md rounded-2xl shadow-2xl border border-slate-700/80
             px-4 sm:px-6 md:px-10 py-6 sm:py-8 md:py-10 text-white safe-bottom"
    >

      <!-- Header -->
      <header class="mb-8">
        <p class="text-xs sm:text-sm uppercase tracking-[0.25em] text-slate-400 mb-2">
          Administración · Planes
        </p>

        <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold tracking-tight">
          Crear nuevo plan
        </h1>

        <p class="text-sm sm:text-base text-slate-300 mt-1 max-w-2xl">
          Completá los datos del plan. El precio se guarda como número real y se muestra con formato ARS.
        </p>
      </header>

      <!-- Card centrada -->
      <div class="flex justify-center">
        <div class="w-full max-w-md bg-slate-900/55 border border-slate-700/70 rounded-2xl p-6 sm:p-8 shadow-lg">

          <!-- Errores -->
          <% if (errores && errores.length) { %>
            <div class="mb-5 rounded-xl border border-rose-400/40 bg-rose-500/10 px-4 py-3 text-rose-200 text-sm">
              <% errores.forEach(error => { %>
                <p>• <%= error %></p>
              <% }) %>
            </div>
          <% } %>

          <!-- Formulario -->
          <form action="/planes/crear" method="POST" class="space-y-5">

            <!-- Nombre -->
            <div class="space-y-1">
              <label for="nombre" class="block text-sm font-medium text-slate-300">
                Nombre
              </label>
              <input
                type="text"
                id="nombre"
                name="nombre"
                placeholder="Nombre del plan"
                required
                value="<%= (datos && datos.nombre) ? datos.nombre : '' %>"
                class="w-full px-4 py-3 rounded-xl
                       bg-slate-900 text-white placeholder-white/35
                       border border-slate-600
                       focus:outline-none focus:ring-2 focus:ring-sky-500/60
                       transition"
              />
            </div>

            <!-- Tipo -->
            <div class="space-y-1">
              <label for="tipo" class="block text-sm font-medium text-slate-300">
                Tipo
              </label>
              <input
                type="text"
                id="tipo"
                name="tipo"
                placeholder="Fibra, Radio, etc."
                required
                value="<%= (datos && datos.tipo) ? datos.tipo : '' %>"
                class="w-full px-4 py-3 rounded-xl
                       bg-slate-900 text-white placeholder-white/35
                       border border-slate-600
                       focus:outline-none focus:ring-2 focus:ring-sky-500/60
                       transition"
              />
            </div>

            <!-- Precio -->
            <div class="space-y-1">
              <label for="precioVisible" class="block text-sm font-medium text-slate-300">
                Precio
              </label>

              <!-- Visible -->
              <input
                type="text"
                id="precioVisible"
                placeholder="$0,00"
                inputmode="numeric"
                class="w-full px-4 py-3 rounded-xl
                       bg-slate-900 text-white placeholder-white/35
                       border border-slate-600
                       focus:outline-none focus:ring-2 focus:ring-sky-500/60
                       transition"
              />

              <!-- Real -->
              <input
                type="hidden"
                id="precio"
                name="precio"
                value="<%= (datos && datos.precio) ? datos.precio : '' %>"
              />
            </div>

            <!-- Botones -->
            <div class="pt-2 flex gap-3">
              <button
                type="submit"
                class="flex-1 bg-sky-600 hover:bg-sky-700 active:bg-sky-800
                       text-white font-semibold py-3 rounded-xl
                       shadow-md hover:shadow-lg transition"
              >
                Guardar plan
              </button>
            </div>

          </form>
        </div>
      </div>

    </div>
  </div>
</main>

<script>
  function formatearMonedaARS(numero) {
    return new Intl.NumberFormat("es-AR", {
      style: "currency",
      currency: "ARS",
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    }).format(numero);
  }

  document.addEventListener("DOMContentLoaded", () => {
    const nombre = document.getElementById("nombre");
    const tipo = document.getElementById("tipo");
    const inputVisible = document.getElementById("precioVisible");
    const inputReal = document.getElementById("precio");

    // placeholders: focus borra, blur vuelve SOLO si está vacío
    [nombre, tipo, inputVisible].forEach((input) => {
      if (!input) return;
      const ph = input.placeholder;
      input.addEventListener("focus", () => input.placeholder = "");
      input.addEventListener("blur", () => {
        if (!input.value.trim()) input.placeholder = ph;
      });
    });

    // Si viene el precio real (ej "12500.50"), mostramos el formato ARS
    if (inputReal.value) {
      const num = Number(inputReal.value);
      if (!Number.isNaN(num)) inputVisible.value = formatearMonedaARS(num);
    }

    // Formateo ARS en vivo y guarda real en hidden
    inputVisible.addEventListener("input", () => {
      const raw = inputVisible.value.replace(/\D/g, "");
      if (raw) {
        const valorNumerico = Number(raw) / 100;
        inputVisible.value = formatearMonedaARS(valorNumerico);
        inputReal.value = valorNumerico.toFixed(2);
      } else {
        inputVisible.value = "";
        inputReal.value = "";
      }
    });
  });
</script>
